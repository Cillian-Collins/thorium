services:
  server:
    build:
      context: server
    image: thorium-server:latest
    ports:
      - "5000:5000"
    volumes:
      - ${EXPLOITS_DIR}:/exploits:rw
      - ${DATABASE_DIR}:/database:rw
  redis:
    image: redis:7.2.0-alpine
    restart: unless-stopped
    command: [ "redis-server", "--appendonly", "yes" ]
    ports:
      - "6379:6379"
  runner:
    build:
      context: runner
    image: thorium-runner:latest
    depends_on:
      - server
    volumes:
      - ${EXPLOITS_DIR}:/exploits:rw
      - ${DATABASE_DIR}:/database:rw
    environment:
      FLAG_REGEX: ${FLAG_REGEX}
      TICK_LENGTH_SECONDS: ${TICK_LENGTH_SECONDS}
